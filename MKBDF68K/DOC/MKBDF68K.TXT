 MKBDF68kはX68000のCG-ROMフォントから16ドットBDFフォントを作成し、最終的に
 はX Window(XFree86)のフォントとして、またMeadow 1.00のフォントとして使え
 るようにしようという目的で作られました。

 重要:「バイナリ、ソース、ドキュメントすべてを含めて完全にフリー」としたい
 と思います。詳しくは tsuika.htmを参照してください。また、以降の内容は2000
 年4月時点のドキュメント(1999.09版)に少し手を加えたものです。[2001.04.01]

  ------------------------------------------------------------------------
                             (チョットX68000魂)
                  X WindowでX68000のROMフォントを表示する
                                 MKBDF68k

                      ｂｙ三津田 哲雄(Mitsuda Tetsuo)
  ------------------------------------------------------------------------

   * はじめに
   * X Windowで使用するフォントについて
   * X68000で実際に行う作業
   * X WindowでX68000のフォントを表示するまで
   * BDFファイルから太字のBDFファイルを作成する
   * konでX68000のフォントを!!
   * Win95/98上のMeadowで使ってみる
        o ~/.emacs （抜粋）
   * ソースファイルからのコンパイル
   * あとがき
   * 使用（テスト)環境

  ------------------------------------------------------------------------

はじめに

Oh!Xが休刊になってから半年くらい経った頃でしょうか、どうしても時代の流れ
と、プロセッサのスピードには勝てず、いつしかPC-9801で動くPC-UNIX、FreeBSDを
メインに使うようになっていました。当然、X68000はあまり使われなくなってしま
ったのはいうまでもありません。そのFreeBSDには当然UNIX上で動くウインドウ環境
のXFree98(XFree86のPC-98版)を走らせていたのですが、どうも標準で用意されてい
る16ドットフォント、k16(jiskan16.pcf.gz)が丸っこいのが気になってしょうがあ
りません。というわけでいままで見慣れているX68000のROMフォントをX上で表示さ
せてみようというのがそもそものきっかけです。

実行ファイル、ソース、ドキュメントの全てをフリーウェアとしプログラムの改造
および再配布は自由とします。ただしこれによって作成されたファイルやそれを元
にして作成されたものはシャープに権利がありますので、作成されたフォントファ
イル等の再配布は禁止です。


必要なものとして次のようなもの(?)があります。


   * X68k本体(ハードディスクはあったほうがいいでしょう、フロッピーディスク
     での運用は少々トリッキーな操作を必要とします。)
   * rootログインできるUNIXマシン(もちろんX-windowが動いているマシンです)
   * UNIX、X-windowについてある程度の知識(xfontsel,xfdを使うことが出来る)
   * ソースプログラムを解読できる知識
   * tar、gzipなどのツール(必須ではありませんが、あれば重宝します。)

使用環境は FreeBSD+XFree86、Linux+XFree86を想定しています。NetBSD/X68kは
X68030が手元にないので厳密にはこうだ!とは言い切れませんが、同じX Window環境
を構築出来るということでおおむねのところは同じ操作で表示することが出来るで
しょう。適当に読みかえて実行して下さい。実際、BDFファイル形式でそのまま使え
るkon等でも使えますし、さらにはMS-Windows 95/98上で動くXEmacs(Mule)である
Meadowでも設定をすれば使うことが出来るようになります。

  ------------------------------------------------------------------------

X Windowで使用するフォントについて

PC-UNIX(FreeBSD,Linux)のフリーで使うことの出来るX WindowであるXFree86では、
フォントはBDF形式というテキストファイルをPCF形式に変換したファイルをX
Window上で使用しています。BDFからPCFへの変換はXFree86の標準パッケージで用意
されている(はず)のbdftopcfというコマンドを使って変換します。ただ、これでは
フォントファイルがディスクのスペースを多く占有してしまうので、実際にはgzip
やcompress等で圧縮してあることがほどんどです。

  % bdftopcf < fontfile.bdf | gzip > fontfile.pcf.gz
  % bdftopcf < fontfile.bdf | compress > fontfile.pcf.Z

もしかしたら他の環境ではBDFから他の形式に変換する必要があるかもしれません
が、全ての場合においてBDF形式のファイルさえあれば他の形式に変換出来るという
点において共通性があるといえます。

また、日本語を表示するためには、半角文字のBDFファイル、全角文字のBDFファイ
ルそれぞれ必要になりますので、これからその2つのファイルをX68000で作成しま
す。

  ------------------------------------------------------------------------

X68000で実際に行う作業

実際に作業するといっても16ドットのBDFフォントファイルを生成するプログラムを
実行するだけです。しかしながら、生成されるBDFフォントファイルが大きくなるこ
ととディスクアクセスの時間から、ハードディスクは必須になります。もちろん、
ROMフォントを吸い出すのでX68000も必要であるのはいうまでもありません。抜け道
としてはEX68を動かすという邪道な手もあり得るのですが、EX68上の動作確認は取
っていませんので注意してください。

とりあえず注意することは、"~"(チルダ）と"\"（バックスラッシュ、円マーク）の
扱いでしょう。SWITCH.Xを使って適切に設定しておきましょう。

実際に使うには、ハードディスクに1.4MB以上の空き領域があることを確認してから

  A:>MKBDF16K > PEKE16K.BDF
  A:>MKBDF16R > PEKE16R.BDF

とすればBDFフォントが生成されます。

今回BDFファイルをテキストファイルとみなしてリダイレクトを使っています。実は
このためにフォントのサイズがPEKE16K.BDFでは1.27MBの大きさになり、2HC(1.2MB)
はおろか、2HD(1.23MB)にも入らないこととなります。困った、フロッピーディスク
環境のひとは指をくわえているしかないのか？そんなことはありません。トリッキ
ーな操作は必要ですが、２つの方法で問題を解決できます。

まずはUNIXでsedによる加工を前提としたBDFファイルを作成する方法です。プログ
ラム実行時に"-t"(Tiny,Tmp)オプションを付けることで、中間ファイルを作るモー
ドになります。違いは改行のかわりに":"を出力しているだけであったりします。

  (X68000) A:>MKBDF16K -t > PEKE16K_.BDF
　　  [フロッピーディスクで転送・・・]
  ( UNIX ) % sed y/:/"\n"/ peke16k_.bdf >peke16k.bdf

次に何とかフロッピーディスクに収まるようにBDFファイルを分割して作成してお
き、UNIX側でファイルを結合させるという方法も"-a","-b"の各オプションを利用す
ることで2HDフロッピーディスクを2枚使っての作業ではありますが、利用が可能で
す。

  (X68000) A:>MKBDF16K -a > PEKE16K.BDA
           A:>MKBDF16K -b > PEKE16K.BDB
　　  [フロッピーディスクで転送・・・]
  ( UNIX ) % cat peke16k.bda peke16k.bdb > peke16k.bdf

これらどちらかの方法で転送したファイルでこれからの作業を同じように行ってい
くことが出来ます。

"-t -a -b"のオプションはMKBDF16K.Xに限って有効です。MKBDF16R.Xではそのよう
な指定をしても無駄ですのであしからず。



  ------------------------------------------------------------------------

X WindowでX68000のフォントを表示するまで


これからは実際にフォントを表示させるUNIXマシン上で行います。もちろんシステ
ム内部の変更ということになるのでこれから先フォントの設定までの項目はroot権
限での作業になります。


まずは適当な場所にファイルが転送され(圧縮などがされているのであればこの時点
で解凍、展開をしておきます。)、目的のBDFファイルの名前が

    peke16k.bdf
    peke16r.bdf

であることをlsコマンドなどを使って確認してください。英字は全て小文字です。
ファイルの転送はどんな形をとってもかまいません。

この時点でフォントファミリ等の変更をしたい方はテキストエディタで変更して下
さい。X Windowではフォントにエイリアスを付けることが可能ですが、例えば
jiskan16.bdfとpeke16k.bdfをそっくりそのまま置き換えたい場合などにはここで編
集することになります。

bdftopcfコマンドとgzipまたはcompressを使って変換、圧縮します。

 % bdftopcf < peke16k.bdf | gzip     > peke16k.pcf.gz
 % bdftopcf < peke16r.bdf | gzip     > peke16r.pcf.gz

次に、出来たファイルをX Windowの日本語のフォントなどが入っている場所にコピ
ーします。X11R6であれば/usr/X11R6/lib/X11/fonts/misc/です。lsコマンドを使っ
てファイル名の最後の拡張子が合致しているかどうかを確認して下さい。

これではまだフォントファイルが登録されないので、mkfontdirコマンドを使って
fonts.dirファイルを更新します。

  % mkfontdir /usr/X11R6/lib/X11/fonts/misc/

/usr/X11R6/lib/X11/fonts/misc/以外に専用のディレクトリを作った、という場合
には、/etc/XF86Configを変更した上でX-Windowを再起動する必要があります。


また、この２つのファイルに対応したフォントのエイリアスを設定します。
/usr/X11R6/lib/X11/fonts/misc/fonts.aliasに次の２行を追加します。(もちろん
この名前でないといけないというわけではないんですが。)

peke16k -peke-fixed-medium-r-normal--16-150-75-75-c-160-jisx0208.1983-0
peke16r -peke-fixed-medium-r-normal--16-150-75-75-c-80-jisx0201.1976-0

現在作業をX Window上で行っていて、X Windowを再起動させることなく文字を表示
するには次のコマンドを実行します。

  % xset fp rehash

これでフォントが表示出来るようになりました。xfontsel、xfdを実行して目的のフ
ォントが表示できることを確認します。

  % xfd -fn peke16r

さらなる確認のために、日本語ターミナルエミュレータを起動します(もしあれ
ば)。

  % kterm -km euc -fk peke16k -fr peke16r -fn peke16r &

これで日本語のテキストを表示させるなどして正常に表示されれば終了です。X
Window上で表示されるX68000のROMフォントを思う存分堪能してください。


  ------------------------------------------------------------------------

BDFファイルから太字のBDFファイルを作成する

そういえば強調文字（ボールド体）のBDFフォントファイルもこの際だから作ってし
まいましょう。これから作成の手順をお教えしましょう。これで作成されるファイ
ル、必須かというとそうでもありません。あくまでおまけ的なものとして考えてく
ださい。

用意するものはbdfbold.cと先ほど作成したpeke16k.bdf、peke16r.bdfです。特に
peke16k.bdfは中間ファイルではないことに注意してください。すでにこの3つのフ
ァイルはUNIXマシン上の適当な場所にコピーされているものとします。

これからの操作はUNIXマシン上で行います。X68000上でもBDFBOLD.Xで作成すること
も不可能ではないのですが、プロセッサのスピードがUNIXの方が速いと踏んでUNIX
マシン上で処理します。X68kではハードディスクに最低4MBの空きがないと苦しいで
しょう。


まずはボールド体作成用プログラムを作りましょう。

  % gcc -o bdfbold bdfbold.c

エラーなくコンパイルが終了したら、ボールド体のフォントをpeke16rb.bdf、
peke16kb.bdfとしてフォントファイルを作成します。コンパイラがパーザエラーを
出してしまった場合には、UNIXマシン上のエディタで"^Z(CTRL+z)"をソースファイ
ル上から削除して、コンパイルしてみてください（一応このためにUNIX上でコンパ
イルできるファイルをtar+gzipで固めたものを収録してあります。）。

作成したbdfboldとそれぞれのフォントファイルがカレントディレクトリにあるもの
として、次のように入力し、実行します。

  % ./bdfbold < peke16r.bdf | sed s/Medium/Bold/ >peke16rb.bdf
  % ./bdfbold < peke16k.bdf | sed s/Medium/Bold/ >peke16kb.bdf

これを先ほどと同じような方法でX Windowのフォントとして登録します。 ちなみに
エイリアスは次の通りに設定しましょう。

peke16kb -peke-fixed-bold-r-normal--16-150-75-75-c-160-jisx0208.1983-0
peke16rb -peke-fixed-bold-r-normal--16-150-75-75-c-80-jisx0201.1976-0


'sed s/Medium/Bold/ 'は一体何をしているのか？フォントの先頭データ部に次のよ
うな加工をしています。察しのいい人なら「こんなのエディタで修正しても同じじ
ゃん。」って思っているでしょうね。

FONT -PEKE-Fixed-Medium-R-Normal--16-150-75-75-C-160-JISX0208.1983-0
WEIGHT_NAME "Medium"

FONT -PEKE-Fixed-Bold-R-Normal--16-150-75-75-C-160-JISX0208.1983-0
WEIGHT_NAME "Bold"

実は、bdfboldは他のフォントも加工が可能だという噂もちらほら。かなりきびしい
条件がありますが、ソースさえ解読できればなんとかなるでしょう。

  ------------------------------------------------------------------------

konでX68000のフォントを!!

kon(漢字コンソール)でも作成したBDFファイルは使えます。640x480の画面なら
80x30のX68000そっくりなテキスト画面が出来上がります。

何らかの理由でX Windowを使えない環境にあり、PC/AT機を使っている人には朗報
(?)です。うまく表示を誤魔化せば（プロンプトを変えるのが一番手っとり早いでし
ょう)、「ノートで動くHuman68k（もどき）」も作成できます。ここではすでにkon
がインストールされた状態であるというのを前提にして話を進めます。

まずは作成したBDFフォントファイルを/usr/share/fonts/peke/にコピーします。も
ちろんディレクトリは勝手に「掘って」下さい。

  % mkdir -p /usr/share/fonts/peke/
  % cp peke16k.bdf /usr/share/fonts/peke/
  % cp peke16r.bdf /usr/share/fonts/peke/

kon.cfgを編集します。FreeBSDのパッケージなら/usr/local/etc/kon.confを、
RHL(RedHatLinux)なら/etc/kon.cfgが相当します。

bdf:Stratup
  /usr/local/bin/fld -t bdf -n /usr/share/fonts/peke/peke16k.bdf
  /usr/local/bin/fld -t bdf -n /usr/share/fonts/peke/peke16r.bdf

次に環境変数をかえてプロンプトを"A:>"に変更します。csh系なら set
prompt="A:>"とすればプロンプトは変更されます。sh系なら PS1="A:>"としましょ
う。もちろんkonを実行しないと画面は変わりません。当たり前です。


まあ、「fish風」とかなんとかいってプロンプトをPC-UNIXで使っているままにして
おくのも一つの手ではあります。

  ------------------------------------------------------------------------

Win95/98上のMeadowで使ってみる

注意：2001.04.01時点で私はMeadow-1.00以降のバージョンの存在を知りません。こ
の内容はそれ以降のバージョンでは適用できない可能性がありますので十分注意し
てください。この内容は2000年04月のものです。

Windows95/98で動くEmacs(Mule)、Meadow-1.00をX68000のフォントで。このような
事が現実のものとなりました。Mule on X68kのような気分が味わえること請け合い
です。実は、この機構、ただ単にBDFフォントをロードしているだけなんですが。

Windows環境ならばEX68でのエミュレーションも捨て難いものがありますが、例えば
Meadow + Cygwin 環境を使っているWindowsユーザで「X68000のフォントを使いた
い」と思われている方のためのものです。特に、Pentium200MHzより遅いプロセッサ
を使っている方には朗報かと思いますが、いかがでしょうか。もちろん、X68000の
画面がそのまま現れるわけではないですけど。

まずはMeadowのインストールから、といいたいところですが、Meadowをインストー
ルするということ自体がかなりDeepな世界のことなんで、Meadowのインストール自
体は扱いません。Meadowをインストールして一通りの設定、ホームディレクトリの
設定等が済んだものとして、.emacsファイルを編集してX68000のフォントを表示し
てみる事に関してのみお話しましょう。

作成したBDFフォントファイル、peke16k.bdf、peke16r.bdfを

  C:\USR\LOCAL\SHARE\FONTS\BDF\PEKE\

にコピーします。ここでは便宜上このディレクトリにしていますが、この限りでは
ありません。フォントファイルのありかさえ正確に把握しているのなら以降の設定
を適当に読み替えて進めてください。というわけで

  半角BDFファイル − C:\USR\LOCAL\SHARE\FONTS\BDF\PEKE\peke16r.bdf
  全角BDFファイル − C:\USR\LOCAL\SHARE\FONTS\BDF\PEKE\peke16k.bdf

がターゲットとなるフォントファイルです。


    ~/.emacs （抜粋）

 (setup-japanese-environment)
 (set-language-environment "Japanese")

 (mw32-ime-initialize)
 (setq default-inputmethod "MW32-IME")

 (add-hook 'mw32-ime-on-hook
          (lambda () (set-cursor-color "brown")))
 (add-hook 'mw32-ime-off-hook
          (lambda () (set-cursor-color "black")))

 (setq mw32-ime-mode-line-state-indicator "[--]")
 (setq mw32-ime-mode-line-state-indicator-list '("--" "[あ]" "[--]" ))

 ;for PEKE16[kr]
 (w32-auto-regist-bdf-font
  "bdf16-japanese-jisx0208-peke"
 "c:/USR/LOCAL/SHARE/FONTS/BDF/PEKE/peke16k.bdf" 0 )
 (w32-auto-regist-bdf-font
  "bdf16-latin-jisx0201-peke"
 "c:/USR/LOCAL/SHARE/FONTS/BDF/PEKE/peke16r.bdf" 0 )
 (w32-auto-regist-bdf-font
  "bdf16-katakana-jisx0201-peke"
 "c:/USR/LOCAL/SHARE/FONTS/BDF/PEKE/peke16r.bdf" 1 )

 ;``peke16'' Font-set (X68000 CG-ROM FONT)
 (new-fontset "peke16"
       '((ascii . "bdf16-latin-jisx0201-peke")
         (japanese-jisx0208 . "bdf16-japanese-jisx0208-peke")
         (latin-jisx0201 . "bdf16-latin-jisx0201-peke")
         (katakana-jisx0201 . "bdf16-katakana-jisx0201-peke")
        ))

 (setq initial-frame-alist
       '((foreground-color . "black")
  (background-color . "white")
  (font . "peke16")
 ))

.emacsファイルが適切に設定されたら、あらためてMeadowを再起動させるとX68000
のROMフォントで表示されているはずです。表示されない場合やおかしな表示になる
ときには、.emacsファイルをよく確認してみてください。

また、上記のように漢字が使われている場合には.emacsファイルの漢字コードに注
意しましょう。

  ------------------------------------------------------------------------

ソースファイルからのコンパイル


  MKBDF16K.C   全角文字(jis-208)を生成するプログラムのソース
  MKBDF16K.ORG 全角文字(jis-208)を生成するプログラムのソース(オリジナル版)
  MKBDF16R.C   半角文字(jis-201)を生成するプログラムのソース
  BDFBOLD.C    ボールド体を作成するフィルタプログラム
  CUT0D.C      改行コードを0x0Aにするフィルタプログラム(qkcやnkf、ackの使用
できる環境であればまず必要ないものです）

ソースファイルのコンパイルはお決まりのパターン、XC2.0以上の環境で

  A:>cc /y MKBDF16K.C
  A:>cc /y MKBDF16R.C

  A:>cc BDFBOLD.C
  A:>cc CUT0D.C


としてコンパイルしてください。

フォントデータの吸い出し部にIOCS関数を使っているだけなので、GCCでのコンパイ
ルもライブラリの指定さえきちんとすればコンパイル可能です。' -liocs 'の指定
を忘れずに。


UNIXでも利用可能なプログラムもあります。

  % cc -o bdfbold bdfbold.c
  % cc -o cut0d cut0d.c

として実行してください。

  ------------------------------------------------------------------------

あとがき

プログラムのみでフォントファイルはありません。ということは実機が必要という
ことです。この部分は「実機が手元にある＝X68000のROMフォントに対して愛着があ
る」と勝手に判断しています。(EX68でのエミュレーションは理論上可能なのですが
未確認です。HDイメージからどうやってWindows上のファイルに落とすんでしょう
か？)

外字はjisx-212に準処しているかどうかわからないので、今の所保留にしてありま
す。外字フォントも登録するとハドソンの蜂マークなんかも表示出来るよう
に・・・なることでしょう。もちろん自前で作成しましょうね。

24ドットフォントについては、まずよほど大きい画面で使っている人しか使わない
だろうということと、差し替えてもそれほど違いの無い字体ということで16ドット
フォントしか作りませんでした。圧縮してフロッピーディスクに収まるかどうかも
怪しいですし（16ドットフォントの圧縮率からして入らないことはないでしょう)。

12ドットフォントは・・・要町フォントが存在します。ですからあえてそういうこ
とをしなくても済むと思います。


  ------------------------------------------------------------------------

使用（テスト)環境


 SHARP X68000 EXPERT2 HD
 (68000/10MHz)              Human68k ver 3.0
 NEC PC-9801 RA21
 (IBM486SX3/60MHz)          FreeBSD(98)2.2.2-R /XFree86 3.2 (XF98_TGUI)
 COMPAQ CONTURA400C         Slackware3.5 + PJE-0.15cm
 (486DX2/40MHz)             XFree86 3.3.3.1 (XF86_SVGA), kon2
 HITACHI FLORA3010CT        FreeBSD 2.2.8
 (486DX2/50MHz)             XFree86 3.3.3.1 (XF86_SVGA), kon2
 NEC PC-9821 Cx2            Windows95/NEC
 (Pentium/75MHz)            Meadow 1.0
 自作PC/AT互換機            Windows98SE日本語版
 (K6/233MHz)                RedhatLunux6.2日本語版



XC ver2.1 -newkit-


   * 一応全てのソースについてX68000上においてGCCでもコンパイル可能です。
   * 一部のソースはFreeBSD上のgccでもコンパイル、動作確認をしています。

参考資料：


   * XC ver2.1 -newkit- の各マニュアル
   * X68000 EXPERT 取扱説明書 (シャープ)
   * XFree86 3.2 document
   * XFree86 online manual
   * kon2のドキュメント、Cソース
   * jiskan16.bdf
   * UNIX USER  (ソフトバンクパブリッシング)
   * ここまでできるFreeBSDパワーガイド (秀和システム)

  ------------------------------------------------------------------------


                       2001.04.01 By Tetsuo Mitsuda(フリー化のための修正)
                                     1999.09 by Teteuo.Mitsuda (加筆修正)
                                                1998.10 by Tetsuo.Mitsuda
                                                      作成者：三津田 哲雄
                                                     メールアドレス：なし
                                                  最終更新日：2001.04.01?
                            ターゲットOS：Human68k/FreeBSD/Linux/Windows9x
                                                           ファイルの先頭へ
(eof)

