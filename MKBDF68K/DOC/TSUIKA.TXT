[2001.04.01付け、追加事項]
  ------------------------------------------------------------------------
                   Oh!X　2001春号掲載時点からの追加事項

                   2001.04.01:三津田 哲雄(MITSUDA Tetsuo)

Oh!X 2001春号P.190-194、「X Windowで X68000のROMフォントを表示する(以下
MKBDF68kとします)」についての追加事項です。
  ------------------------------------------------------------------------

<-本編へ戻る(MKBDF68k.htm)

   * Win32バイナリについて(2001.05.06)
   * ドキュメントも含む「フリー化」について
   * BDFフォントファイルについて
   * PC-UNIXについて
   * フロッピーディスクでの転送について
   * X-Windowについて
   * kon2について
   * Meadowについて
   * X68000のROMフォントとX-Windwoの標準フォントの比較

  ------------------------------------------------------------------------

ここから2001.05.06--
Win32バイナリについて(2001.05.06)

「どーしてもボールド体が作りたいけど、私はX68000とWindows98マシンしか持って
ないのよ。」という方のために、WindowsのDOSプロンプト上で動く実行ファイル
(Win32バイナリ)

   * bdfbold.exe
   * cot0d.exe

を同梱します。動作検証はWindows98SE上で

  1. あらかじめ作成したpeke16k.bdf及びpeke16r.bdfを用意
  2. コンパイルしたファイルを使ってボールド体のBDFフォントを作成(下にある
     「魔法の呪文」)
  3. Meadowで表示

と、ひととおりは行っていますが、信頼性の面で言えばかなり低いといえるでしょ
う。「コンパイルできる」という目安程度に考えておいてください。

コンパイルには 「Borland C++ Compiler 5.5 」 を使わせていただきました。この
コンパイラはフリーで入手が可能ということです。よくC Magazine(ソフトバンクパ
ブリッシング)の付録CD-ROMに収録されているようなので、そちらを購入されて入手
するのが手軽でいいのではないかと思います。

この実行ファイルは以前のバージョンのMS-DOSでは動きません。どうしても動かし
たい奇特な方は、これもフリーで出まわっている「LSI-C86 3.30c試食版」でソース
ファイルをコンパイルしましょう。フィルタプログラムなので、セグメント境界の
問題とは無縁のプログラムですから、正常に動いてくれる…とは限らないところが
曲者です。もしかしたら"bdfbold.c"はソースを修正しないと動かないかもしれませ
ん…。


        魔法の呪文

        "peke16k.bdf"、"peke16r.bdf"、"bdfbold.exe"、"cut0d"の4つ
        のファイルを同じディレクトリに置き、そのディレクトリをカレ
        ントディレクトリとして、

        A:> type peke16k.bdf  |  bdfbold  | cut0d  peke16kb.bdf
        A:> type peke16r.bdf  |  bdfbold  | cut0d  peke16rb.bdf

        と唱えます。

検証用にSJIS文字コードを並べたsjischar.txtを用意しました。このファイルを
Meadowで読み込んで、正常に表示されるかどうかを確認してください。

この"sjischar.txt"はX68000の文字セットですので、Windowsで使われているフォン
トの文字セットにある文字が見当たらないというものもいくつかありますが、普通
に読み書きするぶんにはほとんど支障はありませんので安心してください。気にな
る人は、MS-IMEのヘルプから、「漢字コード表」を参照してください。なお、「IBM
拡張文字」は当然のことながら表示されません。

なお、konでは「瑤(JIS:0x7424/SJIS:0xEAA2)」という字の下半分が欠けて表示され
ます。

--ここまで2001.05.06
  ------------------------------------------------------------------------

ドキュメントも含む「フリー化」について

2001春号の内容で、ドキュメントがCD-ROMに収録されなかったことに気が付きまし
た。私としては「バイナリ、ソース、およびドキュメント」のすべてをどこかで公
開する（またはされる）場合に、「フリー化」するつもりでいました。しかし事情
により、どこにも公開していなかったということと、いくつか不安な要素もあり、
「バイナリおよびソースをフリーとして扱う」旨しか本文に書かなかったのが収録
されなかった理由かと思います(勝手に解釈しました）。しかし、今回Oh!Xで記事と
して誌面に掲載されたことから、それに関するフォローの意味も込めて、「ドキュ
メント類すべてを含めて完全にフリー」としたいと思います。

     フリー化に関する条件

        * 発生する権利そのものは放棄しませんが、このプログラムについて
          の苦情は受け付けません。
        * MKBDF68kに含まれるデータ内容は自由に転載、改造等も許可するこ
          ととし、その際 の連絡は不要とします。
        * このプログラムによって生成されるX68000のROMフォントおよびそ
          れを加工したデータについての権利はシャープにあります。個人で
          楽しむだけにとどめておいてください。

この条件の適用範囲は「mkbdf68k.lzhと、それを解凍して得られるファイル」とし
ます。


はじめからこのように宣言していればOh!XのCD-ROMにドキュメントも含めた形式で
収録されたことでしょうから、なんだか申し訳無いような感じです。どうしても
MKBDF68kを使いたいという人がいるかどうかはわかりませんが、このドキュメント
が役に立てば幸いです。

CD-ROM、DOCディレクトリだけあってドキュメントが収録されていないのはどうして
なんでしょう、私にも本当のところはわかりません。
  ------------------------------------------------------------------------

BDFフォントファイルについて

mkbdf68k.x および mkbdf68r.x で生成されるBDFフォントファイルについてのお話
です。

   * 生成されたBDFフォントファイルは個人使用以外には使わないでください。生
     成されたデータはシャープに権利があるものと思ってください。また、BDFフ
     ォントを使用したことによるいかなる損害、不利益についての責任は負いかね
     ます。
   * 将来、シャープがX68000のROMフォントを「フリー」とし、BDFファイルをリリ
     ースした、という場合には、そのリリースされたBDFフォントファイルを使う
     ようにしてください。この MKBDF68k はあくまで「個人使用」のレベルになん
     とか耐えられるように作られたものですので、BDFファイル(特にヘッダ部分の
     Copyright表示など)が完全ではありません。

BDFフォントファイルの検証

「どうしてもBDFフォントが読み込めない」という場合にはBDFフォントファイルの
データが壊れている可能性があります。通常、ファイルが壊れているかどうかを簡
単に検証する方法は、ファイルサイズやチェックサムを正しいデータのものと比較
するのが正当なやり方なのでしょうが、MKBDF68kの配布にはそのようなデータが一
切ありません。このことは

   * MKBDF68kが出力するBDFフォントデータが完全なものではない
   * プログラムの仕様上

といった都合によるものです。

まあ、同じプログラムを同じ環境で走らせるのですから、よっぽどのことがない限
りmkbdf68k.xやmkbdf68r.xが壊れたデータを吐き出すことはありえません。データ
が壊れるとすればデータをX68000からPC-UNIXマシンへフロッピーディスクでやり
取りする場合などでしょう。案外フロッピーディスクはデータを安全に保ってはく
れないメディアです。可能な限り、BDFフォントファイルは圧縮するなどして転送
しましょう。

 簡易検証(PC-UNIX上で)

 この方法では、ファイルが最後まで書かれているかを簡易検証するものです。
 "tail peke16k.bdf"として最後の行に"ENDFONT"があることを確認するだけでは不
 安な場合にお使いください。

      head -n 30 peke16k.bdf | grep CHARS
      cat peke16k.bdf | wc STARTCHAR

 この２つのコマンドで出力される数値が同じであれば(おそらく)正常に書きこめ
 ています。



  ------------------------------------------------------------------------

フロッピーディスクでの転送について

実はこのプロセスが一番の難関であり、頭を悩ませるところです。X68000XVI
Compactシリーズのように3.5"FDDを搭載しているマシンでもフォーマットの点で大
きな障害があるのに、さらに無印やACE、EXPERT等の5"FDDユーザであればさらにそ
の難易度は上がります。SCSIでもSASIでもHDDを搭載しているほうが有利といえば有
利ではあるのですが、「フロッピーディスクを使ったデータ転送」をしなければな
らないのであればこの問題にぶつかります。


X68000 XVI Compact のHDD搭載モデルなどで、FDDに2DD対応の改造がされているの
であれば、「世界共通の」2DDフォーマットを使えばいいのではないかと思います。
BDFファイルは単純なテキストファイルですので、"peke16k.bdf"を圧縮すれば相当
小さなファイル(200〜300kb?)になります。そうすればPC/AT機側が1200kbや1232kb
のメディアを読めない場合でも転送が可能だと思います。

X680x0のSCSI搭載機種では、MOをつなぐのがもっとも簡単な方法だということをお
教えしておきましょう。もちろんDOS/V機側にもMOをつなぐ必要がありますよ。この
際、メディアの記憶容量に注意する必要があるかもしれません。両方のMOドライブ
が230MBメディアに対応していればすんなりと事が運ぶと思いますが、はたして。

私の場合は、X68000 EXPERT 2(もちろん5インチ機種)に加え、PC-9801 RA (5インチ
機種)と3.5"外付けFDD(3モード対応)という「強い味方」がありましたからそのあた
りは簡単にクリアー出来ました。しかし、SUPER以前のX68000ユーザはそういう特殊
な環境にでもいない限り、5"FDDから3.5"FDDへのメディアコンバートに苦慮するの
は目に見えています。中古でPC-98x1を購入出来る方はそうなさってください。私は
止めません。

他に方策は無いのか、無いわけではありません。それはHuman68kのシリアルポート
と他PCをRS-232Cケーブルでつなぎ、通信ソフトを使ってデータ転送する方法です。
「パソコン通信」経験者であれば気が付かないということはないでしょうが、スピ
ードがいかんせん遅い上に、データの取りこぼしをしやすいこの方法、設定を間違
えると何度やってもデータ化けという悲惨な結果しか待っていないので「現実的で
はない」のです。それでもやってみるのであれば、私から助言を。

     RS-232Cケーブルはクロスケーブルを使いましょう

そういえばOh!Xで何かありましたね、RS-232Cを使ったデータ転送に関する記事が。
あれはいったいどうなったのやら。

そうそう、X68000のコンソール出力をシリアルにするという手もありましたね。


 DOS版FD.EXEのディスク名書き換えについて(動作確認:PC-98用)

 DOS版FD.EXEには強力な機能があります。Human68kで小文字のファイル名を使って
 しまったディスクでもMS-DOSでアクセス可能にしてしまう機能があります。PC-98
 版のFDしか確認していませんので注意してください。以下の操作を行う場合には
 WindowsのDOSプロンプトからではなく、クリーンなDOS環境で行ってください。

 Human68kで英小文字をつけたファイルはMS-DOSで読み取り不可能になるというの
 は知られていますが、これをアクセス可能にする方法です。PC-9801系のマシンを
 想定します。


   1. まずはX68000で小文字を使用したファイル名をつけてしまったファイルの上
      にカーソルを合わせます。
   2. そこで"Rename"コマンドを使います。このとき、名前は変えないでそのまま
      リターンキーを押します。
   3. すると8+3文字になっているものの、ファイルはPC-9801上でアクセスできる
      ようになります。

 ほぼこのようなやり方でアクセス出来るようになります。

何故EX68に触れないか?。それは「私が使ったこと無い」というだけのことです。そ
れだけです。EX68でこの行為を行うのを奨励すればX68000本体の存在価値を下げて
しまうとか、そんなむつかしいことはまったく考えていません。

  ------------------------------------------------------------------------

PC-UNIXについて

MKBDF68kに関するドキュメントの第2版を書いたのが1999.09(オリジナルは1998.09)
というのですから、その当時とはPC-UNIXを取り巻く環境というものがまったく違う
こともあり、いろいろなことで食い違う点がでてくるかもしれません。

ただし、基本的なことは変わらないと思うので

     man bdftopcf

等としてマニュアルページを読んで対処してください。

「日本語パッケージ」等と呼ばれるプログラムを導入している、もしくは日本語デ
ィストリビューションをインストールしている方は「漢字コードコンバータ」とい
う種類のプログラムを探してください。nkfが有名ですが、その使い方をマスターし
ておくと役に立つかもしれません。


CUT0D.Cの使用について

nkf等のプログラムで"CR+LF"から"CR"への改行コードの変換も出来ますが、それが
無い場合には自分でどうにかするほかありません。CUT0D.CはUNIX上のgccでもコン
パイル可能であり、改行コードの簡易変換をするためのプログラムです。簡単なプ
ログラムなので多分gccでなくてもコンパイルできるとは思いますが。カレントデ
ィレクトリに"cut0d.c"を置き、コンパイルします。

     cc -o cut0d cut0d.c

これで"cut0d"という名前でプログラムがカレントディレクトリに作成されまし
た。peke16k.bdfおよびpeke16r.bdfもカレントディレクトリにコピーされていると
した場合、

     mv peke16k.bdf peke16k.bdf.org
     mv peke16r.bdf peke16r.bdf.org
     cat peke16k.bdf.org | ./cut0d peke16k.bdf
     cat peke16r.bdf.org | ./cut0d peke16r.bdf

とします。今までの内容がわからない人はそもそもX68kのROMフォントに愛着を持
つかどうか怪しいので、これに関する詳しい説明は無しです。



MS-DOSフォーマットされたフロッピーディスクのマウントについて

PC-UNIXでフロッピーディスクをマウントする場合、「PC-98フォーマット」と言わ
れる、1232kB(2HD/DOS8)フォーマットのマウントが出来るのは

     FreeBSD(98)2.x

くらいしか心当たりがありません。FreeBSD(98)も3.0以上である場合、サポートさ
れないと記憶しています。1200kB(2HC)フォーマットであればドライブが対応して
いれば他のPC-UNIXでも認識が可能であると思います。

     mount -t msdos /dev/fd0 /mnt
     mount -t vfat    /dev/fd0 /mnt

FreeBSDでは"/dev/fd0.1232"というように、デバイスファイルに容量を指定する必
要があるかもしれません。実際のメディアと違う容量を指定するしてはいけません。

マウントしなくても、フロッピーディスクを扱えるツール、Mtoolsがあるならそち
らを使っていただいてもかまいません。しかしこれもDOSフォーマットしか受け付け
ないのでHuman68kで作成されたフロッピーディスクを直接使用する場合には正常に
動作しない可能性があります。

TwentyOne.xで拡張されたHuman68kではこの限りではありませんが、Human68k単体の
場合と動作が異なるためにここでは想定していません。


         ファイル名を"VeryLongName.htm"としたときの振る舞い
            | 書き込まれた |          |        |        |                |
            |  ファイル名  | Human68k | MS-DOS | VFAT   |Mtools(VFAT対応)|
   ---------+--------------+----------+--------+--------+----------------+
    Human68k| [*1]         | [*1]     |[*2,*5] |[*2,*5] |   [*2,*6]      |
   ---------+--------------+----------+--------+--------+----------------+
     MS-DOS | [*2,4]       | [*2]     | [*2]   | [*2]   |    [*2]        |
   ---------+--------------+----------+--------+--------+----------------+
      VFAT  | [*1(,*3)]    | [*3]     |[*3]    | [*1]   |    [*1]        |
   ---------+--------------+----------+--------+--------+----------------+

        *1 VeryLongName.htm
        *2 VERYLONG.HTM
        *3 VREYLO~1.HTM(MS-DOSファイル名)
        *4 書き込み時に「ファイル名が長すぎます」とエラーが出る可能性あり
        *5 ファイルそのものにアクセス出来ない
        *6 おそらくアクセス不能と思われる



  ------------------------------------------------------------------------

X Windowについて

X Window、特にXFree86では、1999年の段階からかなりの変化がありました。
XFree86は4.0系のリリースがすでに始まっていることやベクトルフォント等をXのフ
ォントとして「当たり前のように」扱える環境を構築できるようになりました。こ
れにより、またMKBDF68kが「要らないもの」になっていくようです。

X Windowでフォントを使う場合、BDFからPCFフォントファイルの形式に変換して
gzipもしくはcompressで圧縮するのですが、Linuxだからgzipを使うとか、FreeBSD
だからcompreesを使うということはないようです。最近の版のXFree86ドキュメント
ではgzipを使うように書かれています。

     cat peke16k.bdf | bdftopcf | gzip >peke16k.pcf.gz

BDFフォントの改行コードやファイル終端コードが問題となる場合には適切に変換や
編集をする必要があります。

本文中ではX Windowのウィンドウマネージャや統合デスクトップのことには詳しく
触れていませんが、私が統合デスクトップなどをストレスなく使える環境にはない
ので、使う気が起きないということで確認作業をしていないだけです。Enlightment
等の「デスクトップテーマ」が使用可能なウィンドウマネージャで、どなたかが
SX-WindowやKo-Window風のテーマを作成していることであろうと淡い期待を寄せて
います。GnomeやKDEについても同様です。

NetBSD X68kで「X Window使っているの時の16ドットフォントがX68000のものでない
のはどうして?」という方はゼヒこのMKBDF68ｋをお試しになって下さい。幸せにな
れるかもしれません。とはいっても動作確認はしていません。

  ------------------------------------------------------------------------

Konについて

「konとノートパソコンの相性はあまりよくないようです」と書いている部分の表現
が適切なものではありませんでした。正確には

     konとノートパソコンの一部機種の組み合わせで問題が発生することもあ
     ります。

と書くべきでした。kon自体が悪さをするというわけではなく、PCの機種によるわず
かな非互換性やその他の問題もかかわっていることが多く、konだけをひきあいに出
したのはあまりよくなかったようです。kon作者の方および関係している皆様にご迷
惑をおかけしたことをここにお詫びします。

konには設定ファイルを書くための作法があります。参考までに私のPCの設定を
"koncfg.txt"という名前で収録しました。このテキストは改行コードを"CR+LF"にし
てあるので、実際にこのファイルをそのまま'kon.cfg'等として使う場合は改行コー
ドを"CR"に変換するようにしてください。

フレームバッファコンソールで動作する漢字コンソール(konとは別のものらしい)が
存在するということらしいですが、その確認は取っていません。
  ------------------------------------------------------------------------

Meadowについて

Meadowについては、2001.04.01現在でもバージョン1.00しか所有していません。も
う1.00がリリースされて長くなるのでバージョンアップされている可能性が高いの
ですが、私の環境ではこれで必要十分であるのでデータ収集などはしていません。

もしMeadowのバージョンが上がっていた場合、この方法が適用出来ない可能性もあ
ります。個々で対応してください。

私の環境で使っているMeadowの設定ファイルを"_emacs.txt"という名前で収録しま
した。参考にしてください。


".emacs"というファイル名にならない?

Windows上で"_emacs.txt"というファイル名を".emacs"に改名したくても、
".emacs"と入力すると

     名前を入力してください

と言われて結局ファイル名を変更できないことがあることがわかりました。解決す
る方法は以下のとおりです。

  1. まずは「メモ帳」などで"_emacs.txt"を開きます。
  2. 内容には手を付けず、「名前を付けて保存」を選びます。
  3. 保存するファイル名を".emacs"として「保存」します。

とても簡単なことですが、重要です。恥ずかしながら、21世紀になってこういった
トラブルを初めて体験しました。

  ------------------------------------------------------------------------

X68000のROMフォントとX-Windowの標準フォントの比較

    *是非、HTML版ドキュメントをご覧になってください。


  ------------------------------------------------------------------------

                                                                       以上
  ------------------------------------------------------------------------
[eof]

